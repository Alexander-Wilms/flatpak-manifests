{
	"app-id": "org.subsurface_divelog.subsurface",
	"runtime": "org.kde.Platform",
	"runtime-version": "master",
	"sdk": "org.kde.Sdk",
	"command": "subsurface",
	"finish-args":[
		"--socket=x11",
		"--share=network",
		"--device=dri"
	],
	"modules":[
		{
			"name":"libssh2",
			"buildsystem":"cmake",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/libssh2/libssh2.git"
				}
			]
		},
		{
			"name":"grantlee",
			"buildsystem":"cmake",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/steveire/grantlee.git"
				}
			]
		},
		{
			"name":"libzip",
			"no-autogen":true,
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/nih-at/libzip.git"
				},
				{
					"type":"shell",
					"commands":["autoreconf -vfi", "./configure --prefix=/app", "make"]
				}
			]
		},
		{
			"name": "subsurface",
			"buildsystem":"simple",
			"builddir":true,
			"sources":[
				{
					"type":"git",
					"url": "git://github.com/Subsurface-divelog/subsurface",
					"dest": "subsurface"
				},
				{
					"type":"git",
					"url":"https://github.com/libgit2/libgit2.git",
					"dest": "libgit2"
				},
				{
					"type":"git",
					"url":"git://git.subsurface-divelog.org/libdc",
					"branch": "Subsurface-branch",
					"dest": "libdivecomputer"
				},
				{
					"type":"git",
					"url":"git://git.subsurface-divelog.org/marble",
					"branch": "Subsurface-branch",
					"dest": "marble-source"
				},
				{
					"type": "shell",
					"commands": [
						"perl -pi -e 's/BUILDGRANTLEE=1/BUILDGRANTLEE=0/' subsurface/scripts/build.sh",
						"perl -pi -e 's/BUILDMARBLE=1/BUILDMARBLE=0/' subsurface/scripts/build.sh"
					]
				},
				{
					"type": "patch",
					"path": "subsurface.patch"
				}
			],
			"build-commands": ["ln -s /app/lib64/libssh2.a /app/lib/libssh2.a && subsurface/scripts/build.sh && cd subsurface/build && LIBRARY_PATH=/app/lib make install prefix=/app"]
		}
	]
}
